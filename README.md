# VolcanicErruption

Mosquito mqtt broker is already deployed on the IP "34.22.169.86" at port "1883". Access the charts generated by simulator on the endpoints: “http://34.76.65.25:3000/d/TKTWEjoVz/test?orgId=1&refresh=5s”

but before that, kindly give me your email address so I can add u as a user in grafana.

Alternatively if u want to get it done on local, follow the steps below

# Step1 : Setting MQTT broker:


Alternatively if u want to deploy the mosquito broker on your own, go to manifest folder, and run the command

kubectl apply -f  MosquitoDeployment.yaml

kubectl apply -f MosquitoService.yaml

After deployment, u will get a public IP.

you can get this IP using the command

kubectl get service --all-namespaces

(Since i dont have any cloud subscription, so I used my husband’s cloud kubernetes cluster whose namespace is ‘mohsin’)

# Step2: Setting up simulator

In the mqtt-simulator/settings.json, change the broker url to the one that was generated in the first step.
build docker image by using command 

docker build . -t username/mqtt-simulator

then push the updated image using command

docker push username/mqtt-simulator

inside manifest folder, go to SimulatorDeployment.yaml and inside container image , replace the value by changing the username in username/mqtt-simulator


now run the following command

kubectl apply -f SimulatorDeployment.yaml

# Step3:  Setting up subscriber

In the subscriber/write.mjs, go to line 11 and change the mqtt broker endpoint to the one generated in the first step

Now, create your own secrets.yaml by using following code, 

apiVersion: v1

kind: Secret

metadata:

  name: volcanodb-secrets
  
  namespace: mohsin
  
 type: Opaque
 
data:

  INFLUX_USER:  base64(infludb_username)
  
  INFLUX_PASSWORD: base64(influxdb_password)
  
  INFLUX_TOKEN: base64(influxdb_APIToken)
  

build docker image by using command

docker build . -t  username/subscriber

then push the updated image using command

docker push username/subscriber

Inside manifest folder, go to SubscriberDeployment.yaml and inside container image , replace the value by changing the username in username/subscriber

now run the following command

kubectl apply -f SubscriberDeployment.yaml


